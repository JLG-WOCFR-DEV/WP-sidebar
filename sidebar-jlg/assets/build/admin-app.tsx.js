(()=>{"use strict";var e={162:(e,t,n)=>{var a=n(609),r=n(888),l="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},i=r.useSyncExternalStore,o=a.useRef,s=a.useEffect,c=a.useMemo,u=a.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,n,a,r){var d=o(null);if(null===d.current){var p={hasValue:!1,value:null};d.current=p}else p=d.current;d=c(function(){function e(e){if(!s){if(s=!0,i=e,e=a(e),void 0!==r&&p.hasValue){var t=p.value;if(r(t,e))return o=t}return o=e}if(t=o,l(i,e))return t;var n=a(e);return void 0!==r&&r(t,n)?(i=e,t):(i=e,o=n)}var i,o,s=!1,c=void 0===n?null:n;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]},[t,n,a,r]);var m=i(e,d[0],d[1]);return s(function(){p.hasValue=!0,p.value=m},[m]),u(m),m}},242:(e,t,n)=>{e.exports=n(162)},493:(e,t,n)=>{var a=n(609),r="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},l=a.useState,i=a.useEffect,o=a.useLayoutEffect,s=a.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!r(e,n)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var n=t(),a=l({inst:{value:n,getSnapshot:t}}),r=a[0].inst,u=a[1];return o(function(){r.value=n,r.getSnapshot=t,c(r)&&u({inst:r})},[e,n,t]),i(function(){return c(r)&&u({inst:r}),e(function(){c(r)&&u({inst:r})})},[e]),s(n),n};t.useSyncExternalStore=void 0!==a.useSyncExternalStore?a.useSyncExternalStore:u},609:e=>{e.exports=window.React},888:(e,t,n)=>{e.exports=n(493)}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var l=t[a]={exports:{}};return e[a](l,l.exports,n),l.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var a=n(609);const r=window.wp.element,l=window.wp.apiFetch;var i=n.n(l);const o=window.wp.components,s=e=>{let t;const n=new Set,a=(e,a)=>{const r="function"==typeof e?e(t):e;if(!Object.is(r,t)){const e=t;t=(null!=a?a:"object"!=typeof r||null===r)?r:Object.assign({},t,r),n.forEach(n=>n(t,e))}},r=()=>t,l={setState:a,getState:r,getInitialState:()=>i,subscribe:e=>(n.add(e),()=>n.delete(e)),destroy:()=>{console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),n.clear()}},i=t=e(a,r,l);return l};var c=n(242);const{useDebugValue:u}=a,{useSyncExternalStoreWithSelector:d}=c;let p=!1;const m=e=>e,v=e=>{"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const t="function"==typeof e?(e=>e?s(e):s)(e):e,n=(e,n)=>function(e,t=m,n){n&&!p&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),p=!0);const a=d(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,n);return u(a),a}(t,e,n);return Object.assign(n,t),n},b={currentStep:0,completed:!0},g=e=>"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e)),f=(e,t,n)=>{const a=(e=>e.replace(/\[(\d+)\]/g,".$1").split(".").map(e=>e.trim()).filter(Boolean))(t),r=g(e);if(!a.length)return r;let l=r;return a.forEach((e,t)=>{const r=t===a.length-1,i=Number(e),o=Number.isInteger(i)&&""!==e?i:e;if(r)Array.isArray(l)&&"number"==typeof o?l[o]=n:Array.isArray(l)||"object"!=typeof l||null===l||(l[o]=n);else if(Array.isArray(l)){if("number"!=typeof o)return;if(void 0===l[o]){const e=Number.isInteger(Number(a[t+1]))?[]:{};l[o]=e}l=l[o]}else if(l&&"object"==typeof l){const e=l;if(!(o in e)||void 0===e[o]){const n=Number.isInteger(Number(a[t+1]))?[]:{};e[o]=n}const n=e[o];n&&("object"==typeof n||Array.isArray(n))&&(l=n)}}),r},E=(N=(e,t)=>({options:{},defaults:{},profiles:[],activeProfile:"default",activeTab:"general",isCanvasOpen:!1,history:[],future:[],onboarding:b,strings:null,preview:null,setActiveTab:t=>e({activeTab:t}),openCanvas:()=>e({isCanvasOpen:!0}),closeCanvas:()=>e({isCanvasOpen:!1}),setOption:(t,n)=>e(e=>({options:f(e.options,t,n),history:[...e.history,g(e.options)],future:[]})),applyServerOptions:t=>e(()=>({options:g(t)})),undo:()=>e(e=>{if(!e.history.length)return e;const t=e.history[e.history.length-1],n=e.history.slice(0,-1),a=[g(e.options),...e.future];return{options:g(t),history:n,future:a}}),redo:()=>e(e=>{if(!e.future.length)return e;const[t,...n]=e.future,a=[...e.history,g(e.options)];return{options:g(t),history:a,future:n}}),canUndo:()=>t().history.length>0,canRedo:()=>t().future.length>0,setOnboardingState:async(t,n=!1)=>{if(e({onboarding:t}),n)try{await i()({path:"/wp/v2/settings",method:"POST",data:{sidebar_jlg_onboarding_state:t}})}catch(e){console.error("Failed to persist onboarding state",e)}},setStrings:t=>e({strings:t})}))?v(N):v,y=()=>{var e;const t=E(e=>e.onboarding),n=E(e=>e.setOnboardingState),r=E(e=>e.setActiveTab),l=E(e=>e.openCanvas),i=E(e=>e.strings),[s,c]=(0,a.useState)(()=>!t.completed&&!0!==t.dismissed);(0,a.useEffect)(()=>{c(!t.completed&&!0!==t.dismissed)},[t]);const u=(0,a.useMemo)(()=>{var e,t,n,a,o,s,c,u,d,p,m,v;if(!i)return[];const b=null!==(e=i.onboardingSteps)&&void 0!==e?e:[],g=null!==(t=i.onboardingCtaLabels)&&void 0!==t?t:[];return[{description:null!==(n=b[0])&&void 0!==n?n:"Activez la sidebar et personnalisez les libellés essentiels.",ctaLabel:null!==(a=g[0])&&void 0!==a?a:"Configurer le général",action:()=>r("general")},{description:null!==(o=b[1])&&void 0!==o?o:"Choisissez les couleurs principales adaptées à votre marque.",ctaLabel:null!==(s=g[1])&&void 0!==s?s:"Adapter les styles",action:()=>r("styles")},{description:null!==(c=b[2])&&void 0!==c?c:"Ajustez votre premier CTA directement dans le canvas interactif.",ctaLabel:null!==(u=g[2])&&void 0!==u?u:"Ouvrir le canvas",action:()=>l()},{description:null!==(d=b[3])&&void 0!==d?d:"Organisez vos profils de diffusion et vérifiez les contextes cibles.",ctaLabel:null!==(p=g[3])&&void 0!==p?p:"Parcourir les profils",action:()=>r("profiles")},{description:null!==(m=b[4])&&void 0!==m?m:"Publiez et partagez votre nouvelle expérience Sidebar JLG !",ctaLabel:null!==(v=g[4])&&void 0!==v?v:"Terminer"}]},[l,r,i]);if(!i||!s||!u.length)return null;const d=u.length,p=Math.min(null!==(e=t.currentStep)&&void 0!==e?e:0,d-1),m=u[p],v=p>=d-1,b=(p+1)/d*100,g=async e=>{await n(e,!0)},f=async()=>{await g({...t,dismissed:!0,completed:t.completed}),c(!1)};return(0,a.createElement)(o.Modal,{title:i.onboardingTitle,onRequestClose:f,className:"sidebar-jlg-onboarding-modal"},(0,a.createElement)("div",{className:"sidebar-jlg-onboarding-modal__intro"},(0,a.createElement)("p",null,i.onboardingDescription),(0,a.createElement)(o.ProgressBar,{value:b,label:`Étape ${p+1} / ${d}`})),(0,a.createElement)(o.Notice,{status:"info",isDismissible:!1},m.description),(0,a.createElement)("div",{className:"sidebar-jlg-onboarding-modal__actions"},(0,a.createElement)(o.Button,{variant:"link",onClick:f},i.onboardingSkip),(0,a.createElement)(o.Button,{variant:"primary",onClick:async()=>{if(m.action?.(),v)return await g({...t,completed:!0,currentStep:p}),void c(!1);await(async()=>{const e=Math.min(p+1,d-1),n=v||e===d-1;await g({...t,currentStep:e,completed:n}),n&&c(!1)})()}},v?i.onboardingFinish:m.ctaLabel)))},_=()=>{var e,t,n;const r=E(e=>e.isCanvasOpen),l=E(e=>e.closeCanvas),i=E(e=>e.options),s=E(e=>e.preview),c=E(e=>e.applyServerOptions),u=E(e=>e.setOption),d=E(e=>e.undo),p=E(e=>e.redo),m=E(e=>e.canUndo()),v=E(e=>e.canRedo()),b=E(e=>e.strings),[g,f]=(0,a.useState)(""),[y,_]=(0,a.useState)(!1),[h,w]=(0,a.useState)(null),C=(0,a.useRef)(null),S=(0,a.useMemo)(()=>(e=>(Array.isArray(e.menu_items)?e.menu_items:[]).findIndex(e=>!(!e||"object"!=typeof e)&&"cta"===e.type))(i),[i]),j=(0,a.useMemo)(()=>{var e,t;return S<0?"#3b82f6":null!==(t=(null!==(e=(Array.isArray(i.menu_items)?i.menu_items:[])[S])&&void 0!==e?e:{}).cta_button_color)&&void 0!==t?t:"#3b82f6"},[i,S]),N=(0,a.useMemo)(()=>s?async()=>{_(!0),w(null);try{var e;const n=new window.FormData;n.append("action",s.action),n.append("nonce",s.nonce),n.append("options",JSON.stringify(i));const a=await window.fetch(s.ajaxUrl,{method:"POST",credentials:"same-origin",body:n}),r=await a.json();var t;if(!r?.success)return void w(null!==(t=b?.previewError)&&void 0!==t?t:"Impossible de charger l’aperçu.");const l=null!==(e=r.data)&&void 0!==e?e:{};"string"==typeof l.html&&f(l.html),l.options&&c(l.options)}catch(e){var n;w(null!==(n=b?.previewError)&&void 0!==n?n:"Impossible de charger l’aperçu.")}finally{_(!1)}}:()=>{},[c,i,s,b]);var A,T;return A=()=>{r&&s&&N()},T=[i,r,s,N],(0,a.useEffect)(()=>{const e=window.setTimeout(()=>{A()},300);return()=>{window.clearTimeout(e)}},T),(0,a.useEffect)(()=>{if(!r)return;const e=C.current;if(!e||S<0)return;const t=[],n=(n,a)=>{const r=e.querySelector(n);if(!r)return;r.setAttribute("contenteditable","true"),r.dataset.sidebarEditable=a;const l=()=>{u(`menu_items[${S}].${a}`,r.innerText.trim())};r.addEventListener("input",l),t.push(()=>{r.removeEventListener("input",l),r.removeAttribute("contenteditable"),delete r.dataset.sidebarEditable})};return n(".menu-cta__title","cta_title"),n(".menu-cta__description","cta_description"),n(".menu-cta__button span","cta_button_label"),()=>{t.forEach(e=>e())}},[S,g,r,u]),r?(0,a.createElement)("div",{className:"sidebar-jlg-preview-canvas",role:"dialog","aria-modal":"true"},(0,a.createElement)("div",{className:"sidebar-jlg-preview-canvas__backdrop","aria-hidden":"true",onClick:l}),(0,a.createElement)("div",{className:"sidebar-jlg-preview-canvas__surface"},(0,a.createElement)("header",{className:"sidebar-jlg-preview-canvas__toolbar"},(0,a.createElement)("div",{className:"sidebar-jlg-preview-canvas__toolbar-group"},(0,a.createElement)(o.Button,{variant:"secondary",onClick:d,disabled:!m},null!==(e=b?.undo)&&void 0!==e?e:"Annuler"),(0,a.createElement)(o.Button,{variant:"secondary",onClick:p,disabled:!v},null!==(t=b?.redo)&&void 0!==t?t:"Rétablir")),(0,a.createElement)(o.Button,{variant:"primary",onClick:l},null!==(n=b?.closeCanvas)&&void 0!==n?n:"Fermer")),h&&(0,a.createElement)("div",{className:"sidebar-jlg-preview-canvas__notice"},(0,a.createElement)(o.Notice,{status:"error",onRemove:()=>w(null)},h)),(0,a.createElement)("div",{className:"sidebar-jlg-preview-canvas__content"},(0,a.createElement)("div",{className:"sidebar-jlg-preview-canvas__preview",ref:C,dangerouslySetInnerHTML:{__html:g}}),S>=0&&(0,a.createElement)("aside",{className:"sidebar-jlg-preview-canvas__inspector"},(0,a.createElement)(o.Panel,null,(0,a.createElement)(o.PanelBody,{title:"CTA",initialOpen:!0},(0,a.createElement)(o.ColorPicker,{color:j,onChangeComplete:e=>{var t;const n="string"==typeof e?e:null!==(t=e.hex)&&void 0!==t?t:j;u(`menu_items[${S}].cta_button_color`,n)}}))))),y&&(0,a.createElement)("div",{className:"sidebar-jlg-preview-canvas__loading",role:"status","aria-live":"polite"},(0,a.createElement)(o.Spinner,null)))):null},h=()=>{var e,t,n,r,l;const i=E(e=>e.options),s=E(e=>e.setOption),c=null!==(e=i.app_name)&&void 0!==e?e:"",u=null!==(t=i.toggle_open_label)&&void 0!==t?t:"",d=null!==(n=i.toggle_close_label)&&void 0!==n?n:"",p=null!==(r=i.nav_aria_label)&&void 0!==r?r:"";return(0,a.createElement)("div",{className:"sidebar-jlg-tab sidebar-jlg-tab--general"},(0,a.createElement)(o.PanelBody,{title:"Accessibilité & activation",initialOpen:!0},(0,a.createElement)(o.ToggleControl,{label:"Activer la sidebar sur le site",checked:Boolean(i.enable_sidebar),onChange:e=>s("enable_sidebar",e)}),(0,a.createElement)(o.ToggleControl,{label:"Collecter les métriques (clics, conversions)",checked:Boolean(i.enable_analytics),onChange:e=>s("enable_analytics",e),help:"Active l'envoi des événements analytics via l'API du plugin."}),(0,a.createElement)(o.TextControl,{label:"Libellé d'ouverture",value:u,onChange:e=>s("toggle_open_label",e),help:"Texte vocalisé pour l'action d'ouverture de la sidebar."}),(0,a.createElement)(o.TextControl,{label:"Libellé de fermeture",value:d,onChange:e=>s("toggle_close_label",e)}),(0,a.createElement)(o.TextControl,{label:"Intitulé ARIA du menu",value:p,onChange:e=>s("nav_aria_label",e)})),(0,a.createElement)(o.PanelBody,{title:"Identité",initialOpen:!0},(0,a.createElement)(o.TextControl,{label:"Nom affiché",value:c,onChange:e=>s("app_name",e)}),(0,a.createElement)(o.TextControl,{label:"Position (gauche/droite)",value:null!==(l=i.sidebar_position)&&void 0!==l?l:"left",onChange:e=>s("sidebar_position",e||"left"),help:"Utilisez left ou right selon la position souhaitée."})))},w=()=>{var e,t,n,r;const l=E(e=>e.options),i=E(e=>e.setOption),s=null!==(e=l.bg_color)&&void 0!==e?e:"#18181b",c=null!==(t=l.accent_color)&&void 0!==t?t:"#0d6efd",u=null!==(n=l.font_color)&&void 0!==n?n:"#e0e0e0",d=Number(null!==(r=l.width_desktop)&&void 0!==r?r:280);return(0,a.createElement)("div",{className:"sidebar-jlg-tab sidebar-jlg-tab--styles"},(0,a.createElement)(o.PanelBody,{title:"Palette",initialOpen:!0},(0,a.createElement)("div",{className:"sidebar-jlg-color-control"},(0,a.createElement)("span",{className:"sidebar-jlg-color-control__label"},"Fond"),(0,a.createElement)(o.ColorPicker,{color:s,onChangeComplete:e=>{var t;const n="string"==typeof e?e:null!==(t=e.hex)&&void 0!==t?t:s;i("bg_color",n)}})),(0,a.createElement)("div",{className:"sidebar-jlg-color-control"},(0,a.createElement)("span",{className:"sidebar-jlg-color-control__label"},"Accent"),(0,a.createElement)(o.ColorPicker,{color:c,onChangeComplete:e=>{var t;const n="string"==typeof e?e:null!==(t=e.hex)&&void 0!==t?t:c;i("accent_color",n)}})),(0,a.createElement)("div",{className:"sidebar-jlg-color-control"},(0,a.createElement)("span",{className:"sidebar-jlg-color-control__label"},"Texte"),(0,a.createElement)(o.ColorPicker,{color:u,onChangeComplete:e=>{var t;const n="string"==typeof e?e:null!==(t=e.hex)&&void 0!==t?t:u;i("font_color",n)}}))),(0,a.createElement)(o.PanelBody,{title:"Dimensions",initialOpen:!0},(0,a.createElement)(o.RangeControl,{label:"Largeur bureau",value:d,onChange:e=>i("width_desktop",Number(null!=e?e:d)),min:200,max:480})))},C=()=>{const e=E(e=>e.profiles),t=E(e=>e.activeProfile);return e.length?(0,a.createElement)("div",{className:"sidebar-jlg-tab sidebar-jlg-tab--profiles"},e.map(e=>{var n,r,l;const i=e,s=null!==(n=i.id)&&void 0!==n?n:"default",c=null!==(r=i.title)&&void 0!==r?r:s,u=null!==(l=i.description)&&void 0!==l?l:"",d=!1!==i.enabled;return(0,a.createElement)(o.Card,{key:s,className:"sidebar-jlg-profile-card"},(0,a.createElement)(o.CardHeader,null,(0,a.createElement)("span",{className:"sidebar-jlg-profile-card__title"},c),s===t&&(0,a.createElement)("span",{className:"sidebar-jlg-profile-card__badge"},"Actif")),(0,a.createElement)(o.CardBody,null,(0,a.createElement)("p",{className:"sidebar-jlg-profile-card__description"},u||"Profil sans description."),(0,a.createElement)("p",{className:"sidebar-jlg-profile-card__meta"},"Statut : ",d?"Activé":"Désactivé")))})):(0,a.createElement)(o.Notice,{status:"warning",isDismissible:!1},"Aucun profil personnalisé n'est encore configuré. Utilisez le canvas pour en créer un en quelques clics.")},S=document.getElementById("sidebar-jlg-admin-app-root"),j=window.sidebarJLGApp;var N;j?.restNonce&&i().use(i().createNonceMiddleware(j.restNonce)),S&&j?((e=>{var t;E.setState({options:g(e.options),defaults:g(e.defaults),profiles:e.profiles,activeProfile:e.activeProfile||"default",onboarding:null!==(t=e.onboarding)&&void 0!==t?t:b,strings:e.strings,preview:e.preview,history:[],future:[],activeTab:"general",isCanvasOpen:!1})})(j),S.classList.add("is-mounted"),(0,r.render)((0,a.createElement)(a.StrictMode,null,(0,a.createElement)(()=>{var e;const t=E(e=>e.activeTab),n=E(e=>e.setActiveTab),l=E(e=>e.openCanvas),i=E(e=>e.strings),s=E(e=>e.options),c=(0,r.useMemo)(()=>{var e,t,n;return[{name:"general",title:null!==(e=i?.generalTab)&&void 0!==e?e:"Général",className:"sidebar-jlg-tab-general"},{name:"styles",title:null!==(t=i?.stylesTab)&&void 0!==t?t:"Styles",className:"sidebar-jlg-tab-styles"},{name:"profiles",title:null!==(n=i?.profilesTab)&&void 0!==n?n:"Profils",className:"sidebar-jlg-tab-profiles"}]},[i]);return i?(0,a.createElement)(a.Fragment,null,(0,a.createElement)(y,null),(0,a.createElement)(o.Panel,{className:"sidebar-jlg-admin-panel"},(0,a.createElement)("div",{className:"sidebar-jlg-admin-panel__header"},(0,a.createElement)("div",null,(0,a.createElement)("h1",{className:"sidebar-jlg-admin-panel__title"},null!==(e=s.app_name)&&void 0!==e?e:"Sidebar JLG"),(0,a.createElement)("p",{className:"sidebar-jlg-admin-panel__subtitle"},i.openCanvas)),(0,a.createElement)(o.Button,{variant:"primary",onClick:l},i.openCanvas)),(0,a.createElement)(o.TabPanel,{className:"sidebar-jlg-admin-tabs",activeClass:"is-active",tabs:c,onSelect:e=>n(e),initialTabName:t},e=>{switch(e.name){case"styles":return(0,a.createElement)(w,null);case"profiles":return(0,a.createElement)(C,null);default:return(0,a.createElement)(h,null)}})),(0,a.createElement)(_,null)):null},null)),S)):S&&S.classList.add("is-missing-bootstrap")})();