"use strict";(globalThis.webpackChunkwp_sidebar=globalThis.webpackChunkwp_sidebar||[]).push([[54],{316:(e,t,n)=>{function i(e,t,n,i){const o=function(e){if(!e||"object"!=typeof e)return{post_types:[],taxonomies:[],roles:[],languages:[],devices:[],login_states:[],schedule_days:[]};const t=e=>Array.isArray(e)?e.reduce((e,t)=>{if(!t||"object"!=typeof t)return e;const n="string"==typeof t.value?t.value:"";if(""===n)return e;const i="string"==typeof t.label&&""!==t.label?t.label:n;return e.push({value:n,label:i}),e},[]):[];return{post_types:t(e.post_types),taxonomies:t(e.taxonomies),roles:t(e.roles),languages:t(e.languages),devices:t(e.devices),login_states:t(e.login_states),schedule_days:t(e.schedule_days)}}(sidebarJLG.profile_choices),s={profiles:[],selectedId:"",activeId:""},r=sidebarJLG.preview_messages&&"string"==typeof sidebarJLG.preview_messages.activeProfile?sidebarJLG.preview_messages.activeProfile:"Profil actif : %s",a=e("#sidebar-jlg-profiles-app"),l=e("#sidebar-jlg-profiles-list"),c=e("#sidebar-jlg-profiles-hidden"),d=e("#sidebar-jlg-profile-editor"),f=e("#sidebar-jlg-profile-title"),u=e("#sidebar-jlg-profile-slug"),p=e("#sidebar-jlg-profile-priority"),g=e("#sidebar-jlg-profile-enabled"),y=e("#sidebar-jlg-profile-post-types"),b=e("#sidebar-jlg-profile-roles"),h=e("#sidebar-jlg-profile-languages"),m=e("#sidebar-jlg-profile-devices"),v=e("#sidebar-jlg-profile-login-state"),_=e("#sidebar-jlg-profile-schedule-start"),x=e("#sidebar-jlg-profile-schedule-end"),j=e("#sidebar-jlg-profile-schedule-days"),A=e("#sidebar-jlg-profile-taxonomies"),I=e("#sidebar-jlg-profile-add-taxonomy"),$=e("#sidebar-jlg-profile-settings-summary"),S=e("#sidebar-jlg-profile-clone-settings"),k=e("#sidebar-jlg-profile-clear-settings"),w=e("#sidebar-jlg-profiles-clear-active"),E=e("#sidebar-jlg-active-profile-field"),L=document.getElementById("sidebar-jlg-profile-taxonomy-template");function D(e){const t=e&&"object"==typeof e?e:{};return{post_types:C(Array.isArray(t.post_types)?t.post_types:Array.isArray(t.content_types)?t.content_types:[]),roles:C(t.roles),languages:O(t.languages),taxonomies:M(t.taxonomies),devices:N(t.devices),logged_in:F(t.logged_in),schedule:G(t.schedule)}}function P(e){if(!e||"object"!=typeof e)return{};const t=SidebarPreviewModule.cloneObject(e)||{};return t&&"object"==typeof t&&Object.prototype.hasOwnProperty.call(t,"profiles")&&delete t.profiles,t}function C(e){if(!Array.isArray(e))return[];const t=[];return e.forEach(e=>{if("string"!=typeof e&&"number"!=typeof e)return;const n=z(String(e));n&&!t.includes(n)&&t.push(n)}),t}function O(e){if(!Array.isArray(e))return[];const t=[];return e.forEach(e=>{if("string"!=typeof e&&"number"!=typeof e)return;const n=String(e).trim();""===n||t.includes(n)||t.push(n)}),t}function N(e){const t=["desktop","mobile"],n=Array.isArray(e)?e:[],i=[];return n.forEach(e=>{if("string"!=typeof e&&"number"!=typeof e)return;const n=z(String(e));n&&t.includes(n)&&!i.includes(n)&&i.push(n)}),i}function F(e){if(Array.isArray(e))return F(e[0]);if(null==e)return"any";if("boolean"==typeof e)return e?"logged-in":"logged-out";if("number"==typeof e)return 0!==e?"logged-in":"logged-out";if("string"!=typeof e)return"any";const t=e.trim().toLowerCase();return""===t||"any"===t?"any":["1","true","yes","on","logged-in","logged_in"].includes(t)?"logged-in":["0","false","no","off","logged-out","logged_out"].includes(t)?"logged-out":"any"}function G(e){var t,n;const i=e&&"object"==typeof e?e:{};return{start:J(null!==(t=i.start)&&void 0!==t?t:i.from),end:J(null!==(n=i.end)&&void 0!==n?n:i.to),days:T(i.days)}}function J(e){if(null==e||""===e)return"";const t=String(e).trim();if(""===t)return"";const n=t.match(/^(\d{1,2}):(\d{2})$/);if(!n)return"";const i=parseInt(n[1],10),o=parseInt(n[2],10);return!Number.isFinite(i)||!Number.isFinite(o)||i<0||i>23||o<0||o>59?"":`${i.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`}function T(e){const t=["mon","tue","wed","thu","fri","sat","sun"];let n=[];Array.isArray(e)?n=e:"string"!=typeof e&&"number"!=typeof e||(n=String(e).split(/[\s,]+/));const i=[];return n.forEach(e=>{if("string"!=typeof e&&"number"!=typeof e)return;let n=String(e).trim().toLowerCase();if(""!==n){switch(n){case"1":case"01":case"monday":case"mon":n="mon";break;case"2":case"02":case"tuesday":case"tue":n="tue";break;case"3":case"03":case"wednesday":case"wed":n="wed";break;case"4":case"04":case"thursday":case"thu":n="thu";break;case"5":case"05":case"friday":case"fri":n="fri";break;case"6":case"06":case"saturday":case"sat":n="sat";break;case"0":case"00":case"7":case"07":case"sunday":case"sun":n="sun"}t.includes(n)&&!i.includes(n)&&i.push(n)}}),i}function M(e){if(!Array.isArray(e))return[];const t=[];return e.forEach(e=>{if(e){if("string"==typeof e||"number"==typeof e){const n=z(String(e));if(!n)return;return void t.push({taxonomy:n,terms:[]})}if("object"==typeof e){const n=z(e.taxonomy||e.name||"");if(!n)return;t.push({taxonomy:n,terms:B(e.terms)})}}}),t}function B(e){const t=[];if(Array.isArray(e))e.forEach(e=>{const n=R(e);null===n||t.includes(n)||t.push(n)});else if("string"==typeof e)e.split(",").forEach(e=>{const n=R(e);null===n||t.includes(n)||t.push(n)});else if("number"==typeof e){const n=R(e);null===n||t.includes(n)||t.push(n)}return t}function R(e){if("number"==typeof e){const t=Math.abs(parseInt(e,10));return Number.isFinite(t)&&t>0?String(t):null}if("string"==typeof e){const t=e.trim();if(""===t)return null;if(/^-?\d+$/.test(t)){const e=Math.abs(parseInt(t,10));return Number.isFinite(e)&&e>0?String(e):null}return z(t)||null}return null}function z(e){if("string"!=typeof e){if(null==e)return"";e=String(e)}return e.trim().toLowerCase().replace(/[^a-z0-9-_]/g,"-").replace(/-{2,}/g,"-").replace(/^-+|-+$/g,"")}function H(e){if("string"!=typeof e){if(null==e)return"";e=String(e)}return e.trim()}function q(e,t=null){const n=z(e)||"profil",i=t instanceof Set?new Set(Array.from(t)):new Set(s.profiles.map(e=>e.id));if(!i.has(n))return n;let o=2,r=`${n}-${o}`;for(;i.has(r);)o+=1,r=`${n}-${o}`;return r}function K(e){return e&&s.profiles.find(t=>t.id===e)||null}function Q(){return K(s.selectedId)}function U(e){const t=H(e.title);return""!==t?t:e.id}function V(){if(l.length){if(!K(s.selectedId)&&s.profiles.length&&(s.selectedId=s.profiles[0].id),l.empty(),0===s.profiles.length){const t=i("profilesListEmpty","Aucun profil n’a encore été créé."),n=e("<li>",{class:"sidebar-jlg-profiles__empty",text:t});return void l.append(n)}s.profiles.forEach(t=>{const n=t.id===s.selectedId,o=t.id===s.activeId,r=e("<li>",{class:`sidebar-jlg-profiles__item${n?" is-active":""}${t.enabled?"":" is-disabled"}`,"data-profile-id":t.id}),a=e("<span>",{class:"sidebar-jlg-profiles__handle",text:"⋮⋮","aria-hidden":"true"}),c=e('<button type="button" class="sidebar-jlg-profiles__select"></button>');c.text(U(t)),c.attr("data-profile-id",t.id),c.attr("aria-pressed",n?"true":"false");const d=e('<span class="sidebar-jlg-profiles__status"></span>');t.enabled||d.text(i("profilesInactiveBadge","Profil désactivé"));const f=e('<label class="sidebar-jlg-profiles__active"></label>'),u=e('<input type="radio" class="sidebar-jlg-profiles__active-input" name="sidebar-jlg-profile-active">');u.val(t.id),u.prop("checked",o),f.append(u),f.append(e("<span></span>").text(i("profilesActiveLabel","Profil actif")));const p=e('<button type="button" class="button-link sidebar-jlg-profiles__delete"></button>');p.text(i("profilesDeleteLabel","Supprimer")),r.append(a,c),d.text()&&r.append(d),r.append(f,p),l.append(r)})}}function W(){if(!d.length)return;const e=Q();if(!e)return d.addClass("is-empty"),d.attr("aria-hidden","true"),d.find("input, select, button").prop("disabled",!0),void($.length&&$.text(""));d.removeClass("is-empty"),d.attr("aria-hidden","false"),d.find("input, select, button").prop("disabled",!1),f.val(e.title),u.val(e.id),p.val(e.priority),g.prop("checked",e.enabled),X(y,o.post_types,e.conditions.post_types),X(b,o.roles,e.conditions.roles),X(h,o.languages,e.conditions.languages),X(m,o.devices,e.conditions.devices),X(v,o.login_states,e.conditions.logged_in&&"any"!==e.conditions.logged_in?[e.conditions.logged_in]:["any"]),X(j,o.schedule_days,e.conditions.schedule.days),_.length&&_.val(e.conditions.schedule.start||""),x.length&&x.val(e.conditions.schedule.end||""),Y(e),te(e)}function X(t,n,i){if(!t||!t.length)return;const o=Array.isArray(i)?i.map(e=>String(e)):[];t.empty(),n.forEach(n=>{const i="string"==typeof n.value?n.value:"";if(""===i)return;const s="string"==typeof n.label&&""!==n.label?n.label:i,r=e("<option></option>").attr("value",i).text(s);o.includes(i)&&r.prop("selected",!0),t.append(r)})}function Y(t){if(!A.length)return;const n=Array.isArray(t.conditions.taxonomies)?t.conditions.taxonomies:[];if(A.empty(),!n.length){const t=e("<p>",{class:"description sidebar-jlg-profiles__taxonomy-placeholder",text:i("profilesConditionsDescription","Définissez les règles qui activent ce profil.")});return void A.append(t)}n.forEach((t,n)=>{const s=function(t,n){let s;if(L&&"string"==typeof L.innerHTML)s=e(L.innerHTML.trim());else{s=e('<div class="sidebar-jlg-profile-taxonomy-row"></div>');const t=e('<select class="sidebar-jlg-profile-taxonomy-name"></select>'),n=e('<input type="text" class="sidebar-jlg-profile-taxonomy-terms">');n.attr("placeholder",i("profilesTaxonomyTermsPlaceholder","Slugs ou IDs séparés par des virgules"));const o=e('<button type="button" class="button-link sidebar-jlg-profile-remove-taxonomy"></button>');o.text(i("profilesDeleteLabel","Supprimer")),s.append(t,n,o)}const r=s.find(".sidebar-jlg-profile-taxonomy-name");X(r,o.taxonomies,[t.taxonomy]),r.attr("data-index",n),r.data("taxonomyIndex",n);const a=s.find(".sidebar-jlg-profile-taxonomy-terms");a.val(t.terms.join(", ")),a.attr("data-index",n),a.data("taxonomyIndex",n);const l=s.find(".sidebar-jlg-profile-remove-taxonomy");return l.attr("data-index",n),l.data("taxonomyIndex",n),s}(t,n);A.append(s)})}function Z(e){e&&!K(e)||(s.activeId=e,V(),ee(),ae())}function ee(){E.length&&E.val(s.activeId||"")}function te(e){if(!$.length)return;const t=ne(e.settings);if(0===t)return void $.text(i("profilesSettingsEmpty","Aucun réglage personnalisé n’est défini pour ce profil."));const n=i("profilesSettingsSummary","Réglages personnalisés : %d champ(s).");$.text(n.replace("%d",t))}function ne(e){return null==e?0:Array.isArray(e)?e.reduce((e,t)=>e+ne(t),0):"object"==typeof e?Object.keys(e).reduce((t,n)=>t+ne(e[n]),0):1}function ie(){c.length&&(c.empty(),s.profiles.forEach((e,t)=>{const n=`sidebar_jlg_profiles[${t}]`;var i,o;oe(`${n}[id]`,e.id),oe(`${n}[title]`,e.title||e.id),oe(`${n}[priority]`,String(e.priority)),oe(`${n}[enabled]`,e.enabled?"1":"0"),se(`${n}[conditions][post_types]`,e.conditions.post_types),se(`${n}[conditions][content_types]`,e.conditions.post_types),i=`${n}[conditions][taxonomies]`,o=e.conditions.taxonomies,Array.isArray(o)&&0!==o.length?o.forEach((e,t)=>{oe(`${i}[${t}][taxonomy]`,e.taxonomy),Array.isArray(e.terms)&&e.terms.length?e.terms.forEach(e=>{oe(`${i}[${t}][terms][]`,e)}):oe(`${i}[${t}][terms][]`,"")}):oe(i,""),se(`${n}[conditions][roles]`,e.conditions.roles),se(`${n}[conditions][languages]`,e.conditions.languages),se(`${n}[conditions][devices]`,e.conditions.devices),oe(`${n}[conditions][logged_in]`,"logged-in"===e.conditions.logged_in?"logged-in":"logged-out"===e.conditions.logged_in?"logged-out":""),function(e,t){const n=t&&"object"==typeof t?t:{start:"",end:"",days:[]};oe(`${e}[start]`,n.start||""),oe(`${e}[end]`,n.end||""),se(`${e}[days]`,Array.isArray(n.days)?n.days:[])}(`${n}[conditions][schedule]`,e.conditions.schedule),re(`${n}[settings]`,e.settings)}))}function oe(t,n){if(!c.length)return;const i=e("<input>",{type:"hidden",name:t,value:n});c.append(i)}function se(e,t){Array.isArray(t)&&0!==t.length?t.forEach(t=>{oe(`${e}[]`,t)}):oe(`${e}[]`,"")}function re(e,t){if(null!=t){if(Array.isArray(t))return t.length?void t.forEach((t,n)=>{re(`${e}[${n}]`,t)}):void oe(`${e}[]`,"");if("object"==typeof t){const n=Object.keys(t);return n.length?void n.forEach(n=>{re(`${e}[${n}]`,t[n])}):void oe(e,"")}oe(e,"boolean"==typeof t?t?"1":"0":String(t))}else oe(e,"")}function ae(){if(!t||!t.container)return;if("ready"!==t.container.getAttribute("data-state"))return;const e=r.replace("%s",function(){if(!s.activeId)return i("profilesDefaultActiveLabel","Réglages globaux");const e=K(s.activeId);return e?U(e):i("profilesDefaultActiveLabel","Réglages globaux")}());t.setStatus(e,!1)}return a.length&&function(){const r=Array.isArray(sidebarJLG.profiles)?sidebarJLG.profiles:[];s.profiles=function(e){const t=new Set,n=[];return e.forEach((e,i)=>{const o=function(e,t,n){var i,o,s,r;const a=e&&"object"==typeof e?e:{},l=z(a.id||a.slug||a.key||""),c=q(""!==l?l:`profil-${n+1}`,t),d=H(a.title||a.name||""),f=function(e,t){if("boolean"==typeof e)return e;if("number"==typeof e)return 0!==e;if("string"==typeof e){const n=e.trim().toLowerCase();return""===n?t:!["0","false","no","off","inactive","disabled"].includes(n)}return null==e?t:Boolean(e)}(null===(i=null!==(o=null!==(s=null!==(r=a.enabled)&&void 0!==r?r:a.is_enabled)&&void 0!==s?s:a.active)&&void 0!==o?o:a.is_active)||void 0===i||i,!0);let u=0;if("number"==typeof a.priority||"string"==typeof a.priority){const e=parseInt(a.priority,10);Number.isFinite(e)&&(u=e)}else if("number"==typeof a.order||"string"==typeof a.order){const e=parseInt(a.order,10);Number.isFinite(e)&&(u=e)}return{id:c,title:d,enabled:f,priority:u,conditions:D(a.conditions),settings:P(a.settings)}}(e,t,i);n.push(o),t.add(o.id)}),n}(r);const a="string"==typeof sidebarJLG.active_profile?sidebarJLG.active_profile:"";s.activeId=s.profiles.some(e=>e.id===a)?a:"",s.selectedId=s.profiles.length?s.profiles[0].id:"",V(),W(),l.length&&"function"==typeof l.sortable&&l.sortable({handle:".sidebar-jlg-profiles__handle",axis:"y",placeholder:"sidebar-jlg-profiles__placeholder",update(){const t=[];l.children().each(function(){const n=e(this).data("profileId");"string"==typeof n&&t.push(n)}),t.length&&(s.profiles.sort((e,n)=>t.indexOf(e.id)-t.indexOf(n.id)),ie())}}),e("#sidebar-jlg-profiles-add").on("click",function(e){e.preventDefault(),function(){const e=i("profilesDefaultTitle","Nouveau profil"),t={id:q(`profil-${s.profiles.length+1}`),title:e,enabled:!0,priority:0,conditions:{post_types:[],roles:[],languages:[],taxonomies:[],devices:[],logged_in:"any",schedule:{start:"",end:"",days:[]}},settings:{}};s.profiles.push(t),s.selectedId=t.id,V(),W(),ie()}()}),l.on("click",".sidebar-jlg-profiles__select",function(){const t=e(this).attr("data-profile-id");"string"==typeof t&&function(e){const t=K(e);t&&(s.selectedId=t.id,V(),W())}(t)}),l.on("click",".sidebar-jlg-profiles__delete",function(t){t.preventDefault();const n=e(this).closest(".sidebar-jlg-profiles__item").data("profileId");if(!n)return;const o=i("profilesDeleteConfirm","Supprimer ce profil ?");o&&!window.confirm(o)||function(e){const t=s.profiles.findIndex(t=>t.id===e);-1!==t&&(s.profiles.splice(t,1),s.selectedId===e&&(s.selectedId=s.profiles.length?s.profiles[0].id:""),s.activeId===e&&(s.activeId=""),V(),W(),ee(),ie(),ae())}(String(n))}),l.on("change",".sidebar-jlg-profiles__active-input",function(){const t=e(this).val();Z("string"==typeof t?t:"")}),f.on("input",function(){const t=Q();t&&(t.title=H(e(this).val()),V())}),u.on("blur",function(){const t=Q();if(!t)return;const n=t.id;let i=z(e(this).val());""===i&&(i=z(t.title)||n);const o=i===n?n:q(i);t.id=o,s.selectedId=o,s.activeId===n&&(s.activeId=o),u.val(o),V(),ee(),ie(),ae()}),p.on("input change",function(){const t=Q();if(!t)return;const n=parseInt(e(this).val(),10);t.priority=Number.isFinite(n)?n:0}),g.on("change",function(){const t=Q();t&&(t.enabled=e(this).is(":checked"),V())}),y.on("change",function(){const t=Q();if(!t)return;const n=Array.isArray(e(this).val())?e(this).val():[];t.conditions.post_types=C(n),ie()}),b.on("change",function(){const t=Q();if(!t)return;const n=Array.isArray(e(this).val())?e(this).val():[];t.conditions.roles=C(n),ie()}),h.on("change",function(){const t=Q();if(!t)return;const n=Array.isArray(e(this).val())?e(this).val():[];t.conditions.languages=O(n),ie()}),m.on("change",function(){const t=Q();if(!t)return;const n=Array.isArray(e(this).val())?e(this).val():[];t.conditions.devices=N(n),ie()}),v.on("change",function(){const t=Q();if(!t)return;const n=e(this).val();t.conditions.logged_in=F(n),X(v,o.login_states,t.conditions.logged_in&&"any"!==t.conditions.logged_in?[t.conditions.logged_in]:["any"]),ie()}),j.on("change",function(){const t=Q();if(!t)return;const n=Array.isArray(e(this).val())?e(this).val():[];t.conditions.schedule.days=T(n),ie()}),_.on("change input",function(){const t=Q();if(!t)return;const n=J(e(this).val());t.conditions.schedule.start=n,e(this).val(n),ie()}),x.on("change input",function(){const t=Q();if(!t)return;const n=J(e(this).val());t.conditions.schedule.end=n,e(this).val(n),ie()}),I.on("click",function(e){e.preventDefault();const t=Q();if(!t)return;const n=o.taxonomies.length?o.taxonomies[0].value:"";t.conditions.taxonomies.push({taxonomy:z(n),terms:[]}),Y(t),ie()}),A.on("change",".sidebar-jlg-profile-taxonomy-name",function(){const t=Q();if(!t)return;const n=parseInt(e(this).attr("data-index"),10);Number.isFinite(n)&&t.conditions.taxonomies[n]&&(t.conditions.taxonomies[n].taxonomy=z(e(this).val()),V(),ie())}),A.on("input change",".sidebar-jlg-profile-taxonomy-terms",function(){const t=Q();if(!t)return;const n=parseInt(e(this).attr("data-index"),10);Number.isFinite(n)&&t.conditions.taxonomies[n]&&(t.conditions.taxonomies[n].terms=B(e(this).val()),ie())}),A.on("click",".sidebar-jlg-profile-remove-taxonomy",function(t){t.preventDefault();const n=Q();if(!n)return;const i=parseInt(e(this).attr("data-index"),10);Number.isFinite(i)&&n.conditions.taxonomies[i]&&(n.conditions.taxonomies.splice(i,1),Y(n),ie())}),S.on("click",function(e){e.preventDefault();const o=Q();if(!o)return;const s=function(){if(!t||!t.currentOptions)return null;const e=SidebarPreviewModule.cloneObject(t.currentOptions);return e&&"object"==typeof e&&Object.prototype.hasOwnProperty.call(e,"profiles")&&delete e.profiles,e||{}}();s?(o.settings=s,te(o),ie(),n("success",i("profilesCloneSuccess","Les réglages actuels ont été associés au profil."))):n("error",i("profilesCloneError","Impossible de copier les réglages actuels."))}),k.on("click",function(e){e.preventDefault();const t=Q();t&&(t.settings={},te(t),ie())}),w.length&&w.on("click",function(e){e.preventDefault(),Z(""),l.find(".sidebar-jlg-profiles__active-input").prop("checked",!1)}),e("#sidebar-jlg-form").on("submit.sidebarProfiles",function(){ee(),ie()}),ee(),ae(),ie()}(),{profilesState:s,syncProfilesToInputs:ie,updateActiveProfileStatusMessage:ae}}n.r(t),n.d(t,{initProfilesSection:()=>i})}}]);