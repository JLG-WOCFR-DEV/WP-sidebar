(()=>{"use strict";const e=window.React,a=JSON.parse('{"apiVersion":2,"name":"jlg/sidebar-search","title":"Sidebar JLG – Recherche","description":"Affiche le formulaire de recherche configuré via Sidebar JLG.","category":"widgets","icon":"search","keywords":["sidebar","search","jlg"],"textdomain":"sidebar-jlg","attributes":{"enable_search":{"type":"boolean","default":false},"search_method":{"type":"string","default":"default"},"search_alignment":{"type":"string","default":"flex-start"},"search_color_scheme":{"type":"string","default":"auto"},"search_shortcode":{"type":"string","default":""}},"supports":{"html":false,"customClassName":false},"editorScript":"file:../../build/sidebar-search.js","viewScript":"file:../../build/sidebar-search-view.js","style":"sidebar-jlg-sidebar-search","editorStyle":"sidebar-jlg-sidebar-search"}'),r=window.wp.blocks,t=window.wp.i18n,s=window.wp.blockEditor,c=window.wp.components,l=window.wp.element;var n,o;const i=[{value:"default",label:(0,t.__)("Formulaire de recherche WordPress","sidebar-jlg")},{value:"shortcode",label:(0,t.__)("Shortcode personnalisé","sidebar-jlg")},{value:"hook",label:(0,t.__)('Hook "jlg_sidebar_search_area"',"sidebar-jlg")}],h=[{value:"flex-start",label:(0,t.__)("Alignement à gauche","sidebar-jlg")},{value:"center",label:(0,t.__)("Alignement centré","sidebar-jlg")},{value:"flex-end",label:(0,t.__)("Alignement à droite","sidebar-jlg")}],d=[{value:"auto",label:(0,t.__)("Palette automatique","sidebar-jlg")},{value:"light",label:(0,t.__)("Palette claire","sidebar-jlg")},{value:"dark",label:(0,t.__)("Palette sombre","sidebar-jlg")}],u=()=>"undefined"!=typeof window&&"undefined"!=typeof document,m=e=>{if("string"!=typeof e)return null;if(""===e||"transparent"===e.toLowerCase())return null;const a=e.match(/^rgba?\(([^)]+)\)$/i);if(!a)return null;const r=a[1].split(",").map(e=>parseFloat(e.trim())).filter(e=>!Number.isNaN(e));if(r.length<3)return null;const[t,s,c,l=1]=r;return{r:Math.min(Math.max(t,0),255),g:Math.min(Math.max(s,0),255),b:Math.min(Math.max(c,0),255),a:Math.min(Math.max(l,0),1)}},_=e=>{const a=e=>{const a=e/255;return a<=.03928?a/12.92:Math.pow((a+.055)/1.055,2.4)};return.2126*a(e.r)+.7152*a(e.g)+.0722*a(e.b)},b=e=>!e||e.a<=.05,g=e=>{if(!u()||!e)return"dark";let a=e;for(;a;){if(a instanceof Element){const e=window.getComputedStyle(a),r=m(e.backgroundColor);if(!b(r))return _(r)<.5?"dark":"light";const t=a.parentNode;a=t instanceof ShadowRoot?t:a.parentElement?a.parentElement:t instanceof Document?t.documentElement:t;continue}if(a instanceof ShadowRoot)a=a.host;else{if(!(a instanceof Document))break;a=a.documentElement}}if(u()&&window.matchMedia)try{if(window.matchMedia("(prefers-color-scheme: dark)").matches)return"dark"}catch(e){}return"light"},f=null!==(n=window.SidebarJlgSearchBlock?.defaults)&&void 0!==n?n:{},p=null!==(o=window.SidebarJlgSearchBlock?.blockName)&&void 0!==o?o:a.name;(0,r.registerBlockType)(a,{edit({attributes:a,setAttributes:r,clientId:n}){const o=(0,l.useRef)(!1);(0,l.useEffect)(()=>{if(o.current)return;o.current=!0;const e={};["enable_search","search_method","search_alignment","search_color_scheme","search_shortcode"].forEach(r=>{void 0===a[r]&&void 0!==f[r]&&(e[r]=f[r])}),Object.keys(e).length>0&&r(e)},[a,r]);const m=(0,l.useMemo)(()=>{var e,r,t,s,c;return{enable_search:null!==(e=a.enable_search)&&void 0!==e&&e,search_method:null!==(r=a.search_method)&&void 0!==r?r:"default",search_alignment:null!==(t=a.search_alignment)&&void 0!==t?t:"flex-start",search_color_scheme:null!==(s=a.search_color_scheme)&&void 0!==s?s:"auto",search_shortcode:null!==(c=a.search_shortcode)&&void 0!==c?c:""}},[a.enable_search,a.search_method,a.search_alignment,a.search_color_scheme,a.search_shortcode]),_=(0,s.useBlockProps)({className:"sidebar-jlg-search-block"}),b=(0,l.useRef)(null),[w,v]=(0,l.useState)(()=>"light"===m.search_color_scheme?"light":"dark");(0,l.useEffect)(()=>{"auto"!==m.search_color_scheme?v("light"===m.search_color_scheme?"light":"dark"):v(g(b.current))},[m.search_color_scheme]),(0,l.useEffect)(()=>{if("auto"!==m.search_color_scheme||!u())return;const e=b.current;if(!e)return;const a=()=>{v(g(e))};a();const r=[];if("ResizeObserver"in window){const t=new ResizeObserver(a);t.observe(e),r.push(()=>t.disconnect())}if("MutationObserver"in window){const t=[e];e.parentElement&&t.push(e.parentElement),t.forEach(e=>{if(!e)return;const t=new MutationObserver(a);t.observe(e,{attributes:!0,subtree:!1,attributeFilter:["class","style","data-sidebar-search-scheme"]}),r.push(()=>t.disconnect())})}if(window.matchMedia)try{const e=window.matchMedia("(prefers-color-scheme: dark)"),t=()=>a();e.addEventListener?(e.addEventListener("change",t),r.push(()=>e.removeEventListener("change",t))):e.addListener&&(e.addListener(t),r.push(()=>e.removeListener(t)))}catch(e){}return()=>{r.forEach(e=>e())}},[m.search_color_scheme]);const j=(0,l.useMemo)(()=>{switch(m.search_alignment){case"center":return"sidebar-search--align-center";case"flex-end":return"sidebar-search--align-end";default:return"sidebar-search--align-start"}},[m.search_alignment]);return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(s.InspectorControls,null,(0,e.createElement)(c.PanelBody,{title:(0,t.__)("Options de recherche","sidebar-jlg"),initialOpen:!0},(0,e.createElement)(c.__experimentalVStack,{spacing:3},(0,e.createElement)(c.ToggleControl,{label:(0,t.__)("Activer la recherche","sidebar-jlg"),checked:!!m.enable_search,onChange:e=>r({enable_search:e})}),(0,e.createElement)(c.SelectControl,{label:(0,t.__)("Méthode de recherche","sidebar-jlg"),value:m.search_method,options:i,onChange:e=>r({search_method:e})}),(0,e.createElement)(c.SelectControl,{label:(0,t.__)("Alignement","sidebar-jlg"),value:m.search_alignment,options:h,onChange:e=>r({search_alignment:e})}),(0,e.createElement)(c.SelectControl,{label:(0,t.__)("Palette de contraste","sidebar-jlg"),value:m.search_color_scheme,options:d,onChange:e=>r({search_color_scheme:e}),help:(0,t.__)("Permet de forcer des couleurs adaptées à un fond clair ou sombre. En mode automatique, la palette s’ajuste selon le contraste détecté.","sidebar-jlg")}),"shortcode"===m.search_method&&(0,e.createElement)(c.TextareaControl,{label:(0,t.__)("Shortcode","sidebar-jlg"),help:(0,t.__)("Le shortcode est exécuté côté front et doit retourner un formulaire de recherche.","sidebar-jlg"),value:m.search_shortcode,onChange:e=>r({search_shortcode:e})})))),(0,e.createElement)("div",{..._,"data-sidebar-search-block-name":p},(0,e.createElement)("div",{ref:b,className:`sidebar-search ${j} sidebar-search--scheme-${w}`,"data-sidebar-search-align":m.search_alignment,"data-sidebar-search-scheme":m.search_color_scheme,"data-sidebar-search-applied-scheme":w,style:{"--sidebar-search-alignment":m.search_alignment}},m.enable_search?"shortcode"===m.search_method?m.search_shortcode?(0,e.createElement)("code",{className:"sidebar-search__shortcode-preview"},m.search_shortcode):(0,e.createElement)("div",{className:"sidebar-search__placeholder"},(0,t.__)("Ajoutez un shortcode valide pour afficher un aperçu.","sidebar-jlg")):"hook"===m.search_method?(0,e.createElement)("div",{className:"sidebar-search__placeholder"},(0,t.__)('Le contenu sera injecté via le hook "jlg_sidebar_search_area".',"sidebar-jlg")):(0,e.createElement)("form",{className:"search-form",role:"search","aria-label":(0,t.__)("Formulaire de recherche","sidebar-jlg")},(0,e.createElement)("label",{htmlFor:`sidebar-search-input-${n}`},(0,e.createElement)("span",{className:"screen-reader-text"},(0,t.__)("Rechercher :","sidebar-jlg")),(0,e.createElement)("input",{id:`sidebar-search-input-${n}`,className:"search-field",type:"search",placeholder:(0,t.__)("Rechercher…","sidebar-jlg"),readOnly:!0})),(0,e.createElement)("button",{type:"submit",className:"search-submit",disabled:!0},(0,t.__)("Recherche","sidebar-jlg"))):(0,e.createElement)(c.Notice,{status:"info",isDismissible:!1},(0,t.__)("La recherche est désactivée pour cette instance.","sidebar-jlg")))))},save:()=>null})})();