(()=>{"use strict";var e={n:r=>{var a=r&&r.__esModule?()=>r.default:()=>r;return e.d(a,{a}),a},d:(r,a)=>{for(var t in a)e.o(a,t)&&!e.o(r,t)&&Object.defineProperty(r,t,{enumerable:!0,get:a[t]})},o:(e,r)=>Object.prototype.hasOwnProperty.call(e,r)};const r=window.React,a=JSON.parse('{"apiVersion":2,"name":"jlg/sidebar-search","title":"Sidebar JLG – Recherche","description":"Affiche le formulaire de recherche configuré via Sidebar JLG.","category":"widgets","icon":"search","keywords":["sidebar","search","jlg"],"textdomain":"sidebar-jlg","attributes":{"enable_search":{"type":"boolean","default":false},"search_method":{"type":"string","default":"default"},"search_alignment":{"type":"string","default":"flex-start"},"search_shortcode":{"type":"string","default":""},"heading":{"type":"string","default":""},"description":{"type":"string","default":""},"heading_level":{"type":"string","enum":["h2","h3","h4","h5","h6"],"default":"h2"}},"supports":{"html":false,"customClassName":false,"color":{"background":true,"text":true,"gradients":true,"link":true},"spacing":{"margin":true,"padding":true,"blockGap":true},"typography":{"fontSize":true,"lineHeight":true,"letterSpacing":true,"textTransform":true,"fontStyle":true,"fontWeight":true,"textDecoration":true}},"styles":[{"name":"default","label":"Défaut","isDefault":true},{"name":"moderne-dark","label":"Critique Moderne (Sombre)"},{"name":"minimal-light","label":"Minimal Clair"},{"name":"retro-warm","label":"Retro & Chaleur"},{"name":"glass-neon","label":"Verre Néon"}],"editorScript":"file:../../build/sidebar-search.js","viewScript":"file:../../build/sidebar-search-view.js","style":"sidebar-jlg-sidebar-search","editorStyle":"sidebar-jlg-sidebar-search"}'),t=window.wp.blocks,n=window.wp.i18n,l=window.wp.blockEditor,s=window.wp.components,i=window.wp.apiFetch;var o=e.n(i);const c=window.wp.element;var d,h;const u=[{value:"default",label:(0,n.__)("Formulaire de recherche WordPress","sidebar-jlg")},{value:"shortcode",label:(0,n.__)("Shortcode personnalisé","sidebar-jlg")},{value:"hook",label:(0,n.__)('Hook "jlg_sidebar_search_area"',"sidebar-jlg")}],g=[{value:"flex-start",label:(0,n.__)("Alignement à gauche","sidebar-jlg")},{value:"center",label:(0,n.__)("Alignement centré","sidebar-jlg")},{value:"flex-end",label:(0,n.__)("Alignement à droite","sidebar-jlg")}],_=[{value:"h2",label:(0,n.__)("Titre 2","sidebar-jlg")},{value:"h3",label:(0,n.__)("Titre 3","sidebar-jlg")},{value:"h4",label:(0,n.__)("Titre 4","sidebar-jlg")},{value:"h5",label:(0,n.__)("Titre 5","sidebar-jlg")},{value:"h6",label:(0,n.__)("Titre 6","sidebar-jlg")}],m=null!==(d=window.SidebarJlgSearchBlock?.defaults)&&void 0!==d?d:{},b=null!==(h=window.SidebarJlgSearchBlock?.blockName)&&void 0!==h?h:a.name;(0,t.registerBlockType)(a,{edit({attributes:e,setAttributes:a}){const t=(0,c.useRef)(!1),i=(0,c.useRef)(0),[d,h]=(0,c.useState)({status:"idle",rendered:"",errorMessage:null});(0,c.useEffect)(()=>{if(t.current)return;t.current=!0;const r={};["enable_search","search_method","search_alignment","search_shortcode","heading","description","heading_level"].forEach(a=>{void 0===e[a]&&void 0!==m[a]&&(r[a]=m[a])}),Object.keys(r).length>0&&a(r)},[e,a]);const p=(0,c.useMemo)(()=>{var r,a,t,n,l,s,i;return{enable_search:null!==(r=e.enable_search)&&void 0!==r&&r,search_method:null!==(a=e.search_method)&&void 0!==a?a:"default",search_alignment:null!==(t=e.search_alignment)&&void 0!==t?t:"flex-start",search_shortcode:null!==(n=e.search_shortcode)&&void 0!==n?n:"",heading:null!==(l=e.heading)&&void 0!==l?l:"",description:null!==(s=e.description)&&void 0!==s?s:"",heading_level:null!==(i=e.heading_level)&&void 0!==i?i:"h2"}},[e.enable_search,e.search_method,e.search_alignment,e.search_shortcode,e.heading,e.description,e.heading_level]),v=(0,l.useBlockProps)({className:"sidebar-jlg-search-block"}),f=(0,c.useMemo)(()=>{switch(p.search_alignment){case"center":return"sidebar-search--align-center";case"flex-end":return"sidebar-search--align-end";default:return"sidebar-search--align-start"}},[p.search_alignment]),w=(0,c.useMemo)(()=>(e=>{if("string"!=typeof e)return{markup:"",hasContent:!1};const r=e.trim();if(""===r)return{markup:"",hasContent:!1};if("undefined"==typeof window||!window.document?.createElement)return{markup:r,hasContent:!0};try{const e=window.document.createElement("div");e.innerHTML=r;const a=e.querySelector(".sidebar-search"),t=null!=a?a:e;"function"==typeof t.querySelectorAll&&t.querySelectorAll(".sidebar-search__heading, .sidebar-search__description").forEach(e=>{e.parentNode?.removeChild(e)});const n=a?a.innerHTML.trim():t.innerHTML.trim(),l="children"in t&&t.children.length>0,s="textContent"in t&&"string"==typeof t.textContent?t.textContent.trim():"";return{markup:n,hasContent:""!==n||""!==s||l}}catch(e){return{markup:r,hasContent:!0}}})(d.rendered),[d.rendered]);return(0,c.useEffect)(()=>{if(!p.enable_search)return void h({status:"idle",rendered:"",errorMessage:null});const e=i.current+1;i.current=e,h(e=>({...e,status:"loading",errorMessage:null}));const r=`/wp/v2/block-renderer/${encodeURIComponent(b)}?context=edit`;o()({path:r,method:"POST",data:{attributes:{enable_search:p.enable_search,search_method:p.search_method,search_alignment:p.search_alignment,search_shortcode:p.search_shortcode,heading:p.heading,description:p.description,heading_level:p.heading_level}}}).then(r=>{if(i.current!==e)return;const a="string"==typeof r?.rendered?r.rendered:"";h({status:"success",rendered:a,errorMessage:null})}).catch(r=>{i.current===e&&h(e=>{var a;return{...e,status:"error",errorMessage:null!==(a=r?.message)&&void 0!==a?a:(0,n.__)("Une erreur est survenue lors du chargement de l’aperçu.","sidebar-jlg")}})})},[p.enable_search,p.search_method,p.search_alignment,p.search_shortcode,b]),(0,r.createElement)(r.Fragment,null,(0,r.createElement)(l.InspectorControls,null,(0,r.createElement)(s.PanelBody,{title:(0,n.__)("Options de recherche","sidebar-jlg"),initialOpen:!0},(0,r.createElement)(s.__experimentalVStack,{spacing:3},(0,r.createElement)(s.ToggleControl,{label:(0,n.__)("Activer la recherche","sidebar-jlg"),checked:!!p.enable_search,onChange:e=>a({enable_search:e})}),(0,r.createElement)(s.SelectControl,{label:(0,n.__)("Méthode de recherche","sidebar-jlg"),value:p.search_method,options:u,onChange:e=>a({search_method:e})}),(0,r.createElement)(s.SelectControl,{label:(0,n.__)("Alignement","sidebar-jlg"),value:p.search_alignment,options:g,onChange:e=>a({search_alignment:e})}),(0,r.createElement)(s.SelectControl,{label:(0,n.__)("Niveau de titre","sidebar-jlg"),value:p.heading_level,options:_,onChange:e=>a({heading_level:e})}),"shortcode"===p.search_method&&(0,r.createElement)(s.TextareaControl,{label:(0,n.__)("Shortcode","sidebar-jlg"),help:(0,n.__)("Le shortcode est exécuté côté front et doit retourner un formulaire de recherche.","sidebar-jlg"),value:p.search_shortcode,onChange:e=>a({search_shortcode:e})})))),(0,r.createElement)("div",{...v,"data-sidebar-search-block-name":b},(()=>{var e;const t={className:["sidebar-search",f,"sidebar-search--scheme-light"].filter(Boolean).join(" "),"data-sidebar-search-align":p.search_alignment,"data-sidebar-search-scheme":"auto",style:{"--sidebar-search-alignment":p.search_alignment}},i="loading"===d.status,o=(0,r.createElement)("div",{className:"sidebar-search__loading"},(0,r.createElement)(s.Spinner,null)),h=_.find(({value:e})=>e===p.heading_level),u=null!==(e=h?.value)&&void 0!==e?e:"h2",g=(0,r.createElement)("div",{className:"sidebar-search__placeholder"},(0,n.__)("Aucun contenu n’a été retourné par le serveur pour cette configuration.","sidebar-jlg"));let m;return m=(p.enable_search?null:(0,r.createElement)(s.Notice,{status:"info",isDismissible:!1},(0,n.__)("La recherche est désactivée pour cette instance.","sidebar-jlg")))||(w.hasContent?(0,r.createElement)("div",{className:"sidebar-search__render","aria-live":"polite"},(0,r.createElement)(c.RawHTML,null,w.markup),i&&o):i?o:g),(0,r.createElement)(r.Fragment,null,d.errorMessage&&(0,r.createElement)(s.Notice,{status:"error",isDismissible:!1},d.errorMessage),(0,r.createElement)("div",{...t,"aria-live":"polite"},(0,r.createElement)(l.RichText,{tagName:u,className:"sidebar-search__heading",value:p.heading,placeholder:(0,n.__)("Ajouter un titre…","sidebar-jlg"),allowedFormats:["core/bold","core/italic","core/link","core/strikethrough"],onChange:e=>a({heading:e})}),(0,r.createElement)(l.RichText,{tagName:"div",className:"sidebar-search__description",value:p.description,placeholder:(0,n.__)("Ajouter une description…","sidebar-jlg"),onChange:e=>a({description:e}),allowedFormats:["core/bold","core/italic","core/link","core/strikethrough","core/underline"],multiline:"p"}),m))})()))},save:()=>null})})();