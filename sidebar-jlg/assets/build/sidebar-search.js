(()=>{"use strict";const e=window.React,r=JSON.parse('{"apiVersion":2,"name":"jlg/sidebar-search","title":"Sidebar JLG – Recherche","description":"Affiche le formulaire de recherche configuré via Sidebar JLG.","category":"widgets","icon":"search","keywords":["sidebar","search","jlg"],"textdomain":"sidebar-jlg","attributes":{"enable_search":{"type":"boolean","default":false},"search_method":{"type":"string","default":"default"},"search_alignment":{"type":"string","default":"flex-start"},"search_shortcode":{"type":"string","default":""}},"supports":{"html":false,"customClassName":false},"editorScript":"file:../../build/sidebar-search.js","viewScript":"file:../../build/sidebar-search-view.js","style":"sidebar-jlg-sidebar-search","editorStyle":"sidebar-jlg-sidebar-search"}'),a=window.wp.blocks,t=window.wp.i18n,s=window.wp.blockEditor,l=window.wp.components,n=window.wp.serverSideRender,c=window.wp.element;var i,o;const d=[{value:"default",label:(0,t.__)("Formulaire de recherche WordPress","sidebar-jlg")},{value:"shortcode",label:(0,t.__)("Shortcode personnalisé","sidebar-jlg")},{value:"hook",label:(0,t.__)('Hook "jlg_sidebar_search_area"',"sidebar-jlg")}],h=[{value:"flex-start",label:(0,t.__)("Alignement à gauche","sidebar-jlg")},{value:"center",label:(0,t.__)("Alignement centré","sidebar-jlg")},{value:"flex-end",label:(0,t.__)("Alignement à droite","sidebar-jlg")}],u=null!==(i=window.SidebarJlgSearchBlock?.defaults)&&void 0!==i?i:{},_=null!==(o=window.SidebarJlgSearchBlock?.blockName)&&void 0!==o?o:r.name;(0,a.registerBlockType)(r,{edit({attributes:r,setAttributes:a}){const i=(0,c.useRef)(!1),o=(0,c.useRef)("");(0,c.useEffect)(()=>{if(i.current)return;i.current=!0;const e={};["enable_search","search_method","search_alignment","search_shortcode"].forEach(a=>{void 0===r[a]&&void 0!==u[a]&&(e[a]=u[a])}),Object.keys(e).length>0&&a(e)},[r,a]);const m=(0,c.useMemo)(()=>{var e,a,t,s;return{enable_search:null!==(e=r.enable_search)&&void 0!==e&&e,search_method:null!==(a=r.search_method)&&void 0!==a?a:"default",search_alignment:null!==(t=r.search_alignment)&&void 0!==t?t:"flex-start",search_shortcode:null!==(s=r.search_shortcode)&&void 0!==s?s:""}},[r.enable_search,r.search_method,r.search_alignment,r.search_shortcode]),b=(0,s.useBlockProps)({className:"sidebar-jlg-search-block"}),g=(0,c.useMemo)(()=>{switch(m.search_alignment){case"center":return"sidebar-search--align-center";case"flex-end":return"sidebar-search--align-end";default:return"sidebar-search--align-start"}},[m.search_alignment]),f=(0,c.useMemo)(()=>({block:_,attributes:{enable_search:m.enable_search,search_method:m.search_method,search_alignment:m.search_alignment,search_shortcode:m.search_shortcode},httpMethod:"POST"}),[_,m.enable_search,m.search_method,m.search_alignment,m.search_shortcode]),p=(0,n.useServerSideRender)(f);return(0,c.useEffect)(()=>{if(m.enable_search){if("success"===p.status){const e="string"==typeof p.content?p.content:"",r=e.trim();o.current=""!==r?e:""}}else o.current=""},[m.enable_search,p.status,p.content]),(0,e.createElement)(e.Fragment,null,(0,e.createElement)(s.InspectorControls,null,(0,e.createElement)(l.PanelBody,{title:(0,t.__)("Options de recherche","sidebar-jlg"),initialOpen:!0},(0,e.createElement)(l.__experimentalVStack,{spacing:3},(0,e.createElement)(l.ToggleControl,{label:(0,t.__)("Activer la recherche","sidebar-jlg"),checked:!!m.enable_search,onChange:e=>a({enable_search:e})}),(0,e.createElement)(l.SelectControl,{label:(0,t.__)("Méthode de recherche","sidebar-jlg"),value:m.search_method,options:d,onChange:e=>a({search_method:e})}),(0,e.createElement)(l.SelectControl,{label:(0,t.__)("Alignement","sidebar-jlg"),value:m.search_alignment,options:h,onChange:e=>a({search_alignment:e})}),"shortcode"===m.search_method&&(0,e.createElement)(l.TextareaControl,{label:(0,t.__)("Shortcode","sidebar-jlg"),help:(0,t.__)("Le shortcode est exécuté côté front et doit retourner un formulaire de recherche.","sidebar-jlg"),value:m.search_shortcode,onChange:e=>a({search_shortcode:e})})))),(0,e.createElement)("div",{...b,"data-sidebar-search-block-name":_},(()=>{var r,a;const s={className:`sidebar-search ${g}`,"data-sidebar-search-align":m.search_alignment,style:{"--sidebar-search-alignment":m.search_alignment}};if(!m.enable_search)return(0,e.createElement)("div",{...s},(0,e.createElement)(l.Notice,{status:"info",isDismissible:!1},(0,t.__)("La recherche est désactivée pour cette instance.","sidebar-jlg")));const n="string"==typeof p.content?p.content:"",i=n.trim(),d=null!==(r=o.current)&&void 0!==r?r:"",h=d.trim(),u=m.enable_search&&("loading"===p.status||"idle"===p.status),_=""!==i,b=_?n:!_&&u&&""!==h?d:"",f=b.trim();let v=""!==f;if(v&&"undefined"!=typeof window&&window.document){const e=window.document.createElement("div");e.innerHTML=f;const r=e.querySelector(".sidebar-search"),a=null!=r?r:e,t=a.children.length>0,s=a.textContent?a.textContent.trim():"";v=t||""!==s}const w=(0,e.createElement)("div",{className:"sidebar-search__loading"},(0,e.createElement)(l.Spinner,null)),j=(0,e.createElement)("div",{className:"sidebar-search__placeholder"},(0,t.__)("Aucun contenu n’a été retourné par le serveur pour cette configuration.","sidebar-jlg")),E="error"===p.status?null!==(a=p.error)&&void 0!==a?a:(0,t.__)("Une erreur est survenue lors du chargement de l’aperçu.","sidebar-jlg"):null;return(0,e.createElement)(e.Fragment,null,E&&(0,e.createElement)(l.Notice,{status:"error",isDismissible:!1},E),""!==f&&v?(0,e.createElement)("div",{className:"sidebar-search__render","aria-live":"polite"},(0,e.createElement)(c.RawHTML,null,b),u&&w):(0,e.createElement)("div",{...s,"aria-live":"polite"},u?w:j))})()))},save:()=>null})})();