(()=>{"use strict";var e={n:r=>{var a=r&&r.__esModule?()=>r.default:()=>r;return e.d(a,{a}),a},d:(r,a)=>{for(var t in a)e.o(a,t)&&!e.o(r,t)&&Object.defineProperty(r,t,{enumerable:!0,get:a[t]})},o:(e,r)=>Object.prototype.hasOwnProperty.call(e,r)};const r=window.React,a=JSON.parse('{"apiVersion":2,"name":"jlg/sidebar-search","title":"Sidebar JLG – Recherche","description":"Affiche le formulaire de recherche configuré via Sidebar JLG.","category":"widgets","icon":"search","keywords":["sidebar","search","jlg"],"textdomain":"sidebar-jlg","attributes":{"enable_search":{"type":"boolean","default":false},"search_method":{"type":"string","default":"default"},"search_alignment":{"type":"string","default":"flex-start"},"search_shortcode":{"type":"string","default":""},"heading":{"type":"string","default":""},"description":{"type":"string","default":""},"heading_level":{"type":"string","enum":["h2","h3","h4","h5","h6"],"default":"h2"}},"supports":{"html":false,"customClassName":false},"editorScript":"file:../../build/sidebar-search.js","viewScript":"file:../../build/sidebar-search-view.js","style":"sidebar-jlg-sidebar-search","editorStyle":"sidebar-jlg-sidebar-search"}'),t=window.wp.blocks,l=window.wp.i18n,n=window.wp.blockEditor,s=window.wp.components,i=window.wp.apiFetch;var c=e.n(i);const d=window.wp.element;var o,h;const u=[{value:"default",label:(0,l.__)("Formulaire de recherche WordPress","sidebar-jlg")},{value:"shortcode",label:(0,l.__)("Shortcode personnalisé","sidebar-jlg")},{value:"hook",label:(0,l.__)('Hook "jlg_sidebar_search_area"',"sidebar-jlg")}],g=[{value:"flex-start",label:(0,l.__)("Alignement à gauche","sidebar-jlg")},{value:"center",label:(0,l.__)("Alignement centré","sidebar-jlg")},{value:"flex-end",label:(0,l.__)("Alignement à droite","sidebar-jlg")}],_=[{value:"h2",label:(0,l.__)("Titre 2","sidebar-jlg")},{value:"h3",label:(0,l.__)("Titre 3","sidebar-jlg")},{value:"h4",label:(0,l.__)("Titre 4","sidebar-jlg")},{value:"h5",label:(0,l.__)("Titre 5","sidebar-jlg")},{value:"h6",label:(0,l.__)("Titre 6","sidebar-jlg")}],b=null!==(o=window.SidebarJlgSearchBlock?.defaults)&&void 0!==o?o:{},m=null!==(h=window.SidebarJlgSearchBlock?.blockName)&&void 0!==h?h:a.name;(0,t.registerBlockType)(a,{edit({attributes:e,setAttributes:a}){const t=(0,d.useRef)(!1),i=(0,d.useRef)(0),[o,h]=(0,d.useState)({status:"idle",rendered:"",errorMessage:null});(0,d.useEffect)(()=>{if(t.current)return;t.current=!0;const r={};["enable_search","search_method","search_alignment","search_shortcode","heading","description","heading_level"].forEach(a=>{void 0===e[a]&&void 0!==b[a]&&(r[a]=b[a])}),Object.keys(r).length>0&&a(r)},[e,a]);const v=(0,d.useMemo)(()=>{var r,a,t,l,n,s,i;return{enable_search:null!==(r=e.enable_search)&&void 0!==r&&r,search_method:null!==(a=e.search_method)&&void 0!==a?a:"default",search_alignment:null!==(t=e.search_alignment)&&void 0!==t?t:"flex-start",search_shortcode:null!==(l=e.search_shortcode)&&void 0!==l?l:"",heading:null!==(n=e.heading)&&void 0!==n?n:"",description:null!==(s=e.description)&&void 0!==s?s:"",heading_level:null!==(i=e.heading_level)&&void 0!==i?i:"h2"}},[e.enable_search,e.search_method,e.search_alignment,e.search_shortcode,e.heading,e.description,e.heading_level]),p=(0,n.useBlockProps)({className:"sidebar-jlg-search-block"}),f=(0,d.useMemo)(()=>{switch(v.search_alignment){case"center":return"sidebar-search--align-center";case"flex-end":return"sidebar-search--align-end";default:return"sidebar-search--align-start"}},[v.search_alignment]);return(0,d.useEffect)(()=>{if(!v.enable_search)return void h({status:"idle",rendered:"",errorMessage:null});const e=i.current+1;i.current=e,h(e=>({...e,status:"loading",errorMessage:null}));const r=`/wp/v2/block-renderer/${encodeURIComponent(m)}?context=edit`;c()({path:r,method:"POST",data:{attributes:{enable_search:v.enable_search,search_method:v.search_method,search_alignment:v.search_alignment,search_shortcode:v.search_shortcode,heading:v.heading,description:v.description,heading_level:v.heading_level}}}).then(r=>{if(i.current!==e)return;const a="string"==typeof r?.rendered?r.rendered:"";h({status:"success",rendered:a,errorMessage:null})}).catch(r=>{i.current===e&&h(e=>{var a;return{...e,status:"error",errorMessage:null!==(a=r?.message)&&void 0!==a?a:(0,l.__)("Une erreur est survenue lors du chargement de l’aperçu.","sidebar-jlg")}})})},[v.enable_search,v.search_method,v.search_alignment,v.search_shortcode,m]),(0,r.createElement)(r.Fragment,null,(0,r.createElement)(n.InspectorControls,null,(0,r.createElement)(s.PanelBody,{title:(0,l.__)("Options de recherche","sidebar-jlg"),initialOpen:!0},(0,r.createElement)(s.__experimentalVStack,{spacing:3},(0,r.createElement)(s.ToggleControl,{label:(0,l.__)("Activer la recherche","sidebar-jlg"),checked:!!v.enable_search,onChange:e=>a({enable_search:e})}),(0,r.createElement)(s.SelectControl,{label:(0,l.__)("Méthode de recherche","sidebar-jlg"),value:v.search_method,options:u,onChange:e=>a({search_method:e})}),(0,r.createElement)(s.SelectControl,{label:(0,l.__)("Alignement","sidebar-jlg"),value:v.search_alignment,options:g,onChange:e=>a({search_alignment:e})}),(0,r.createElement)(s.TextControl,{label:(0,l.__)("Titre","sidebar-jlg"),value:v.heading,onChange:e=>a({heading:e})}),(0,r.createElement)(s.SelectControl,{label:(0,l.__)("Niveau de titre","sidebar-jlg"),value:v.heading_level,options:_,onChange:e=>a({heading_level:e})}),(0,r.createElement)(s.TextareaControl,{label:(0,l.__)("Description","sidebar-jlg"),value:v.description,onChange:e=>a({description:e})}),"shortcode"===v.search_method&&(0,r.createElement)(s.TextareaControl,{label:(0,l.__)("Shortcode","sidebar-jlg"),help:(0,l.__)("Le shortcode est exécuté côté front et doit retourner un formulaire de recherche.","sidebar-jlg"),value:v.search_shortcode,onChange:e=>a({search_shortcode:e})})))),(0,r.createElement)("div",{...p,"data-sidebar-search-block-name":m},(()=>{var e,a;const t={className:["sidebar-search",f,"sidebar-search--scheme-light"].filter(Boolean).join(" "),"data-sidebar-search-align":v.search_alignment,"data-sidebar-search-scheme":"auto",style:{"--sidebar-search-alignment":v.search_alignment}};if(!v.enable_search)return(0,r.createElement)("div",{...t},(0,r.createElement)(s.Notice,{status:"info",isDismissible:!1},(0,l.__)("La recherche est désactivée pour cette instance.","sidebar-jlg")));const i=null!==(e=o.rendered?.trim?.())&&void 0!==e?e:"",c="loading"===o.status,h=""!==i;let u=h;if(h&&"undefined"!=typeof window&&window.document){const e=window.document.createElement("div");e.innerHTML=i;const r=e.querySelector(".sidebar-search"),a=null!=r?r:e,t=a.children.length>0,l=a.textContent?a.textContent.trim():"";u=t||""!==l}const g=(0,r.createElement)("div",{className:"sidebar-search__loading"},(0,r.createElement)(s.Spinner,null)),b=_.find(({value:e})=>e===v.heading_level),m=null!==(a=b?.value)&&void 0!==a?a:"h2",p=v.heading?.trim?.(),w=v.description?.trim?.(),j=p?(0,r.createElement)(n.RichText.Content,{tagName:m,className:"sidebar-search__heading",value:v.heading}):null,E=w?(0,r.createElement)(n.RichText.Content,{tagName:"div",className:"sidebar-search__description",value:v.description}):null,y=(0,r.createElement)("div",{className:"sidebar-search__placeholder"},(0,l.__)("Aucun contenu n’a été retourné par le serveur pour cette configuration.","sidebar-jlg"));return(0,r.createElement)(r.Fragment,null,o.errorMessage&&(0,r.createElement)(s.Notice,{status:"error",isDismissible:!1},o.errorMessage),h&&u?(0,r.createElement)("div",{className:"sidebar-search__render","aria-live":"polite"},(0,r.createElement)(d.RawHTML,null,i),c&&g):(0,r.createElement)("div",{...t,"aria-live":"polite"},j,E,c?g:y))})()))},save:()=>null})})();