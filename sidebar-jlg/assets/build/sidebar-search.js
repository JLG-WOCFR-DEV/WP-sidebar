(()=>{"use strict";var e={n:r=>{var a=r&&r.__esModule?()=>r.default:()=>r;return e.d(a,{a}),a},d:(r,a)=>{for(var t in a)e.o(a,t)&&!e.o(r,t)&&Object.defineProperty(r,t,{enumerable:!0,get:a[t]})},o:(e,r)=>Object.prototype.hasOwnProperty.call(e,r)};const r=window.React,a=JSON.parse('{"apiVersion":2,"name":"jlg/sidebar-search","title":"Sidebar JLG – Recherche","description":"Affiche le formulaire de recherche configuré via Sidebar JLG.","category":"widgets","icon":"search","keywords":["sidebar","search","jlg"],"textdomain":"sidebar-jlg","attributes":{"enable_search":{"type":"boolean","default":false},"search_method":{"type":"string","default":"default"},"search_alignment":{"type":"string","default":"flex-start"},"search_shortcode":{"type":"string","default":""}},"supports":{"html":false,"customClassName":false},"editorScript":"file:../../build/sidebar-search.js","viewScript":"file:../../build/sidebar-search-view.js","style":"sidebar-jlg-sidebar-search","editorStyle":"sidebar-jlg-sidebar-search"}'),t=window.wp.blocks,s=window.wp.i18n,n=window.wp.blockEditor,l=window.wp.components,c=window.wp.apiFetch;var o=e.n(c);const i=window.wp.element;var d,h;const u=[{value:"default",label:(0,s.__)("Formulaire de recherche WordPress","sidebar-jlg")},{value:"shortcode",label:(0,s.__)("Shortcode personnalisé","sidebar-jlg")},{value:"hook",label:(0,s.__)('Hook "jlg_sidebar_search_area"',"sidebar-jlg")}],_=[{value:"flex-start",label:(0,s.__)("Alignement à gauche","sidebar-jlg")},{value:"center",label:(0,s.__)("Alignement centré","sidebar-jlg")},{value:"flex-end",label:(0,s.__)("Alignement à droite","sidebar-jlg")}],m=null!==(d=window.SidebarJlgSearchBlock?.defaults)&&void 0!==d?d:{},b=null!==(h=window.SidebarJlgSearchBlock?.blockName)&&void 0!==h?h:a.name;(0,t.registerBlockType)(a,{edit({attributes:e,setAttributes:a}){const t=(0,i.useRef)(!1),c=(0,i.useRef)(0),[d,h]=(0,i.useState)({status:"idle",rendered:"",errorMessage:null});(0,i.useEffect)(()=>{if(t.current)return;t.current=!0;const r={};["enable_search","search_method","search_alignment","search_shortcode"].forEach(a=>{void 0===e[a]&&void 0!==m[a]&&(r[a]=m[a])}),Object.keys(r).length>0&&a(r)},[e,a]);const g=(0,i.useMemo)(()=>{var r,a,t,s;return{enable_search:null!==(r=e.enable_search)&&void 0!==r&&r,search_method:null!==(a=e.search_method)&&void 0!==a?a:"default",search_alignment:null!==(t=e.search_alignment)&&void 0!==t?t:"flex-start",search_shortcode:null!==(s=e.search_shortcode)&&void 0!==s?s:""}},[e.enable_search,e.search_method,e.search_alignment,e.search_shortcode]),p=(0,n.useBlockProps)({className:"sidebar-jlg-search-block"}),f=(0,i.useMemo)(()=>{switch(g.search_alignment){case"center":return"sidebar-search--align-center";case"flex-end":return"sidebar-search--align-end";default:return"sidebar-search--align-start"}},[g.search_alignment]);return(0,i.useEffect)(()=>{if(!g.enable_search)return void h({status:"idle",rendered:"",errorMessage:null});const e=c.current+1;c.current=e,h(e=>({...e,status:"loading",errorMessage:null}));const r=`/wp/v2/block-renderer/${encodeURIComponent(b)}?context=edit`;o()({path:r,method:"POST",data:{attributes:{enable_search:g.enable_search,search_method:g.search_method,search_alignment:g.search_alignment,search_shortcode:g.search_shortcode}}}).then(r=>{if(c.current!==e)return;const a="string"==typeof r?.rendered?r.rendered:"";h({status:"success",rendered:a,errorMessage:null})}).catch(r=>{c.current===e&&h(e=>{var a;return{...e,status:"error",errorMessage:null!==(a=r?.message)&&void 0!==a?a:(0,s.__)("Une erreur est survenue lors du chargement de l’aperçu.","sidebar-jlg")}})})},[g.enable_search,g.search_method,g.search_alignment,g.search_shortcode,b]),(0,r.createElement)(r.Fragment,null,(0,r.createElement)(n.InspectorControls,null,(0,r.createElement)(l.PanelBody,{title:(0,s.__)("Options de recherche","sidebar-jlg"),initialOpen:!0},(0,r.createElement)(l.__experimentalVStack,{spacing:3},(0,r.createElement)(l.ToggleControl,{label:(0,s.__)("Activer la recherche","sidebar-jlg"),checked:!!g.enable_search,onChange:e=>a({enable_search:e})}),(0,r.createElement)(l.SelectControl,{label:(0,s.__)("Méthode de recherche","sidebar-jlg"),value:g.search_method,options:u,onChange:e=>a({search_method:e})}),(0,r.createElement)(l.SelectControl,{label:(0,s.__)("Alignement","sidebar-jlg"),value:g.search_alignment,options:_,onChange:e=>a({search_alignment:e})}),"shortcode"===g.search_method&&(0,r.createElement)(l.TextareaControl,{label:(0,s.__)("Shortcode","sidebar-jlg"),help:(0,s.__)("Le shortcode est exécuté côté front et doit retourner un formulaire de recherche.","sidebar-jlg"),value:g.search_shortcode,onChange:e=>a({search_shortcode:e})})))),(0,r.createElement)("div",{...p,"data-sidebar-search-block-name":b},(()=>{var e;const a={className:["sidebar-search",f,"sidebar-search--scheme-light"].filter(Boolean).join(" "),"data-sidebar-search-align":g.search_alignment,"data-sidebar-search-scheme":"auto",style:{"--sidebar-search-alignment":g.search_alignment}};if(!g.enable_search)return(0,r.createElement)("div",{...a},(0,r.createElement)(l.Notice,{status:"info",isDismissible:!1},(0,s.__)("La recherche est désactivée pour cette instance.","sidebar-jlg")));const t=null!==(e=d.rendered?.trim?.())&&void 0!==e?e:"",n="loading"===d.status,c=""!==t;let o=c;if(c&&"undefined"!=typeof window&&window.document){const e=window.document.createElement("div");e.innerHTML=t;const r=e.querySelector(".sidebar-search"),a=null!=r?r:e,s=a.children.length>0,n=a.textContent?a.textContent.trim():"";o=s||""!==n}const h=(0,r.createElement)("div",{className:"sidebar-search__loading"},(0,r.createElement)(l.Spinner,null)),u=(0,r.createElement)("div",{className:"sidebar-search__placeholder"},(0,s.__)("Aucun contenu n’a été retourné par le serveur pour cette configuration.","sidebar-jlg"));return(0,r.createElement)(r.Fragment,null,d.errorMessage&&(0,r.createElement)(l.Notice,{status:"error",isDismissible:!1},d.errorMessage),c&&o?(0,r.createElement)("div",{className:"sidebar-search__render","aria-live":"polite"},(0,r.createElement)(i.RawHTML,null,t),n&&h):(0,r.createElement)("div",{...a,"aria-live":"polite"},n?h:u))})()))},save:()=>null})})();